---
title: "ICTSC2024 二次予選 問題解説: [MNG] MongoDBってなんですか？"
description: "ICTSC2024 二次予選 問題解説: MongoDBってなんですか？"
tags: [ICTSC2024,問題解説]
pubDate: 2024-12-14T12:00:00
slug: "2024/12/14/ictsc2024pr/mng"
draft: false
renderer: "md"
sticky: false
---

# 問題文

I社の新人のあなたは、昼過ぎにあるアプリケーションのアラートを受け取った。
どうやら、あるデータベースでエラーが散発しているようだ。
先輩に聞いてみたが、どうやら先輩もアプリケーションやデータベースの構成に詳しくなく、調査するように頼まれた。アプリケーションもはるか昔に書かれたもので、詳しくない人が書いたらしいが……

どうやらMongoDBというデータベースが使われているとのことだが、とりあえず調査してみよう。

## 前提条件

- 特にありません
- どうやらI社の人はこのデータベースについてあまり詳しくないようであり、諸々の設定に意図があるのかどうかはわかりません

## 初期状態

- ホストにログインすると、ホームディレクトリに `ictsc-2024-problem-mng` というバイナリが存在します
- これを(どれか1台のVMで)実行しながら、別のコンソール等でVMへ接続し、以下に示すような操作を行うと確率的にエラーが生じることが確認できます
  - 場合によっては連続で成功することもありますが、しばらく(10回〜20回ほど)続けていると問題が再現するはずです
  - もし再現しない場合には質問として運営へ問い合わせてください

```
$ ./ictsc-2024-problem-mng
(特に何も表示されない)
```

```
$ mongosh "mongodb://mng-01,mng-02,mng-03/ictsc?socketTimeoutMS=200"
rs0 [primary] ictsc> db.data.updateOne({i: 3, j: 30}, {"$set": {t: +(new Date)}})
MongoNetworkTimeoutError: connection 9 to 192.168.255.81:27017 timed out

```

なお、 `socketTimeoutMS=200` はこのクエリを実行するのに通常掛かるであろうレイテンシの数倍としています。

## 終了状態

初期状態で提示したエラーがなぜ生じているのかを調査・考察し、その原因と解決策について、1000字以下(コマンドのアウトプット等は除く)で説明してください。

(1000字という字数は、過剰な時間を掛ける必要はないという程度の意味合いです。例えば400字だから一概に減点するというようなことではありません)
