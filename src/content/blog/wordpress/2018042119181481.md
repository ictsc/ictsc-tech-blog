---
title: "ICTSC9のバックボーン解説"
description: "ICTSC9のバックボーン解説"
tags: [ICTSC9]
pubDate: 2018-04-21T19:18:27
slug: "2018/04/21/ICTSC9のバックボーン解説"
draft: false
renderer: "html"
sticky: false
---

<p>こんにちは、バックボーンなどインフラを担当した川原です。</p>
<p>参加者の皆さん、参加してくださり誠にありがとうございました。今回も30分のサーバの電源断、1日目のWi-Fiの不調など、皆さんにご不便をお掛けしてしまい申し訳ありませんでした。特にWi-Fiにつきましては、アンケートでも厳しい意見が多かったためバックボーン担当として重く受け止めています。ただ、Wi-Fiの調子は人数が増えてみないとわからないことも多いです。年々、改善を繰り返しながら取り組んでおりますので今後とも率直な意見をくださりながら参加して楽しんでいただければと思います。</p>
<p>また、機材提供・協力をはじめとした協賛企業の皆様、毎度のことながら我々学生の無茶な要望を受け入れてくださり誠にありがとうございます。今回も参加者へのインフラを提供する傍ら、運営学生も貴重な体験をすることができました。</p>
<p>さて、堅苦しい話はここまでとして今回も大規模なインフラを組んで皆さんに提供しました。LTなどでも話しましたが、改めてブログにまとめることで多くの人にネットワークやサーバに興味を持って欲しいと思っています。</p>
<p>今回のインフラは何人かで担当しているので、担当した各人がブログへ投稿することになっています。この記事では最初の記事として全体の総括をしていきたいと思います。</p>
<p>個別の解説は以下のとおりです．</p>
<ul>
<li><a href="https://blog.icttoracon.net/2018/04/02/ictsc9%e3%81%ae%e3%83%90%e3%83%83%e3%82%af%e3%83%9c%e3%83%bc%e3%83%b3%e8%a7%a3%e8%aa%ac-srx1500%e7%b7%a8/" rel="noopener" target="_blank">SRX1500編</a></li>
<li><a href="https://blog.icttoracon.net/2018/04/02/ictsc9%e3%81%ae%e3%83%90%e3%83%83%e3%82%af%e3%83%9c%e3%83%bc%e3%83%b3%e8%a7%a3%e8%aa%ac-qfx5100%e7%b7%a8/" rel="noopener" target="_blank">QFX5100編</a></li>
<li><a href="https://blog.icttoracon.net/2018/04/02/ictsc9%e3%81%ae%e3%83%90%e3%83%83%e3%82%af%e3%83%9c%e3%83%bc%e3%83%b3%e8%a7%a3%e8%aa%ac-cisco-nexus-55482248%e7%b7%a8/" rel="noopener" target="_blank">Cisco Nexus 5548,2248編</a></li>
<li><a href="https://blog.icttoracon.net/2018/04/06/ictsc-tech-blog-ictsc9%e3%81%ae%e3%83%90%e3%83%83%e3%82%af%e3%83%9c%e3%83%bc%e3%83%b3%e8%a7%a3%e8%aa%ac-%e7%84%a1%e7%b7%9alan%e7%b7%a8/" rel="noopener" target="_blank">無線LAN編</a></li>
<li><a href="https://blog.icttoracon.net/2018/04/02/ictsc9%e3%81%ae%e3%83%90%e3%83%83%e3%82%af%e3%83%9c%e3%83%bc%e3%83%b3%e8%a7%a3%e8%aa%ac-homenoc%e7%b7%a8/" rel="noopener" target="_blank">HomeNOC編</a></li>
<li><a href="https://blog.icttoracon.net/2018/04/02/ictsc9%e3%81%ae%e3%83%90%e3%83%83%e3%82%af%e3%83%9c%e3%83%bc%e3%83%b3%e8%a7%a3%e8%aa%ac-%e7%9b%a3%e8%a6%96%e7%b7%a8/" rel="noopener" target="_blank">監視編</a></li>
<li><a href="https://blog.icttoracon.net/2018/03/18/ictsc9-openstack/" rel="noopener" target="_blank">OpenStack編</a></li>
</ul>
<h2>バックボーンについて</h2>
<p>我々ICTSC運営において、バックボーンとは全チームが問題を解くために使うインフラのことを言います。バックボーン担当は作問など大会開催に必要なタスクをこなす傍ら、興味のある人が思い思いのインフラを構築していくことになります。</p>
<p>バックボーンの目的は以下です。</p>
<ul>
<li>参加者が問題を快適に解ける環境を提供する</li>
<li>ICTSC運営が問題を提供しやすい環境を提供する</li>
</ul>
<p>つまり、1に参加者、2に参加者、3くらいに問題作成者のことを考えて作るわけです。勘違いすると安定感に欠けた目的のわからないものになってしまうので、気をつけなくてはいけません。また、どんな問題でも出題できるように準備をしています。インフラ的に難しいからこの問題はボツで…ということは極力ないようにします。</p>
<p>問題作成は運営発足から行われるものなので、運営発足からHotstage(本番の大会会場で本番の機材を使いながら準備する期間)中のインフラもある程度安定させなければ、よい品質の問題を用意することができなくなってしまいます。そのあたりの差し引きをしながら本番環境を構築していくのもバックボーン構築の醍醐味です。</p>
<h2>今回のバックボーンテーマについて</h2>
<p>最近のICTSCのバックボーンはテーマを決めて構築を行っています。第7回は安定感、第8回は仮想化でした。</p>
<p>今回は… <strong>冗長化!!</strong></p>
<p>ということで構築されたバックボーンネットワークは以下のように、今回のテーマに則ってネットワーク機材をすべて冗長化しています。</p>
<p><img decoding="async" loading="lazy" src="/images/wp/2018/03/Inked__LI.jpg.webp" alt="" width="2183" height="1290" class="alignnone size-full wp-image-1682" /></p>
<p>各機材の冗長構成については各担当の者がそれぞれ本ブログに投稿することになっているので楽しみにしていてください。概要については当日の発表資料を以下に用意しました。</p>
<iframe src='https://www.slideshare.net/slideshow/embed_code/92763222' width='425' height='348' sandbox="allow-popups allow-scripts allow-same-origin allow-presentation" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe>
<h2>当日発生したトラブルについて</h2>
<p>どれだけ準備しようがトラブルは起きてしまうものです。当日起きてしまったトラブルをまとめていきます。</p>
<h3>1日目 11:30頃 サーバ電源断</h3>
<p>1日目 11:30頃にサーバの全台が電源断するという障害が発生しました。昼食が早まったことで解答不可能になった時間は比較的少なくなりましたが、ご迷惑をお掛けしてしまい誠に申し訳ございませんでした。</p>
<h4>原因</h4>
<p>我々の不手際によって協賛の皆さんが半分のサーバを接続している電源系統でPCの充電をしてしまったことによる過負荷でおきたものであると考えられます。また、その後私が生きていたサーバのコンセントを抜くというミスオペを犯してしまいました。</p>
<h4>改善策</h4>
<p>改善策としては、サーバは冗長化が行えていなかったためサーバの電源をそのような危険性がある電源からではなくアクセスしにくい電源を選択するなどがあります。ネットワーク機器は最悪電源が落ちても2系統とっていましたし、再起動も比較的高速に行えます。何よりサーバの電源断はHDDなどが故障する可能性もあります。</p>
<p>ミスオペに関してはダブルチェックなどを行うなどがあります。ただ、復旧を一丸となって行えたのでとても良かったと思います。私を責めずに冷静に私の指示に従ってくれたみんなには感謝です。</p>
<h3>1日目 懇親会</h3>
<p>Wi-Fiの調子が悪いという話を多くの方から聞きました。懇親会後、原因の調査と修正を行いました。2日目の開始時にも軽くお伝えしましたが、ストレスを感じさせてしまい申し訳ありませんでした。</p>
<h4>原因</h4>
<p>2.4Ghz帯の電波が強すぎたことによって、多くのクライアントが2.4Ghz帯で接続し混線したものと考えられます。</p>
<h4>改善策</h4>
<p>2.4Ghz帯の電波を弱める、5Ghz帯でクライアントが接続できているか監視するなどの対策を行いました。我々の感知している範囲では2日目は快適に使用できていたと聞いています。</p>
<p>しかし、競技時間の半分を不快な環境で回答していたことについては反省会でも話題になりました。次回以降はWi-Fiの調子などを早めに聞く機会を設け、早めに対策が行えるように努力します。みなさんもストレスを感じた場合は気軽に問い合わせ下さい。バックボーン側に原因がある場合は早急に対応いたします。</p>
<p>また、Wi-Fiの調子は当日の人数が入らないとわからないことも多いです。次回以降の運営からも当日アナウンスがあるとは思いますが、Wi−Fiが不調の場合は有線接続の使用をご検討ください。</p>
<h3>2日目 13時頃</h3>
<p>一部グローバルIP(Googleなど)への接続ができなくなるという障害が発生しました。障害は3分ほど継続した後、収束しました。</p>
<h4>原因</h4>
<p><a href="/images/wp/2018/04/8rBcZCL.png.webp"><img decoding="async" loading="lazy" src="/images/wp/2018/04/8rBcZCL-1024x305.png.webp" alt="" width="1024" height="305" class="alignnone size-large wp-image-1701" /></a></p>
<p>以上の障害発生時のメトリクスを見ても、障害発生時間帯にルート数が5000経路ほど減少していました。また、こちらの設定ミスか上流からのトラフィックを受信しているのに、こちらからトラフィックが流れていませんでした。障害発生から5分以内にメトリクスを把握し上流であるHomeNOC様に確認したところ、一部障害が発生していたとお聞きしました。</p>
<p>しかし、このようなことが発生してもよいように上流は冗長化していましたが、うまく動作しませんでした。冗長化が動作しなかった原因としては、IPv4のフルルートを受け取っていた影響でルートの収束まで時間がかかってしまったようです。準備期間中や開催後に接続断テストを行った際には収束まで約10分の時間を要しました。</p>
<p>原因究明にはメトリクスによる可視化が重要であることを実感できた障害でもありました。</p>
<h4>改善策</h4>
<p>なぜ、収束までにここまでの時間が発生するのかは我々も理解しきれていません。勉強してきます。</p>
<p>フルルートの運用をしてみないとわからないことは多く存在します。このような貴重な機会をくださったHomeNOC様に感謝しております。</p>
<h2>おまけ: ベンチマーク</h2>
<p>今回、テンションがおかしくなってしまった運営学生は10Gbps NICをヤフオクで9本程度落札してしまいました。それをNAVTサーバに搭載し、バックボーンに組み込んでいました。大会終了後、バックボーンネットワークがどれほどの帯域を出せるのかベンチマークを取りました。</p>
<h3>実験環境</h3>
<p>18:13ごろから18:23ごろまでOpenstackのVM 10台から、別のVM 10台までiperf3を実行しました。以下のような経路を通り、通信を行いました。</p>
<p><a href="/images/wp/2018/04/2ae329e51649a89f6eee9c3a50c40b90.png.webp"><img decoding="async" loading="lazy" src="/images/wp/2018/04/2ae329e51649a89f6eee9c3a50c40b90-1024x693.png.webp" alt="" width="1024" height="693" class="alignnone size-large wp-image-1700" /></a></p>
<p>その後、18:28以降に同様の経路でOpenstackのVM 15台から、別のVM 15台までiperf3を実行していました。</p>
<h3>結果</h3>
<p><a href="/images/wp/2018/04/graph.png.webp"><img decoding="async" loading="lazy" src="/images/wp/2018/04/graph-1024x592.png.webp" alt="" width="1024" height="592" class="alignnone size-large wp-image-1694" /></a></p>
<p><a href="/images/wp/2018/04/result.png.webp"><img decoding="async" loading="lazy" src="/images/wp/2018/04/result-1024x610.png.webp" alt="" width="1024" height="610" class="alignnone size-large wp-image-1695" /></a></p>
<p>わかりにくいですが、18:13ごろから18:23ごろまで <code>5 Gbps</code> 、 18:28以降は <code>8 Gbps</code> の流量が出ていることが右下の<code>Traffic of server</code> と <code>transmit traffics of servers</code> のグラフからわかります。このグラフは、Openstackのホストサーバの受信と送信の流量を示しています。</p>
<p>タイトルが消えてしまっていますが右上のグラフがNAVT 2台の流量合計です。このグラフからも <code>8 Gbps</code> まで出ていることがわかります。</p>
<p>真ん中の <code>Traffics between Nexus5548 and QFX5100</code> のグラフはNexus5548とQFX5100の間の4本の流量をそれぞれ示しており、上半分が送信、下半分が受信になっています。このグラフだけ単位が <code>Bytes per sec</code> になっていることに注意してください。</p>
<h3>考察</h3>
<p><del datetime="2018-03-18T15:34:27+00:00">楽しかった！！</del></p>
<p>LACPのハッシュアルゴリズムの偏りによって、 <code>1 Gbps * 2</code> を出せるサーバが確率的に <code>1 Gbps</code> しか出てないことがあり、15台のVM同士の通信では <code>8 Gbps</code> までしか実験を行うことができませんでした。右下の <code>Traffic of server</code> と <code>transmit traffics of servers</code> のグラフからOpenstackのVM同士の合計トラフィックが <code>8 Gbps</code> しか出てないことがわかります。今回のバックボーンのキャパシティは <code>20 Gbps</code> であったため、今回のベンチマークはバックボーンのベンチマークというよりサーバのベンチマークになってしまいました。特に左下の <code>CPU idle</code> のグラフでは各ホストのcpu0の <code>idle</code> が大幅に下回っており、サーバで <code>10 Gbps</code> を処理をする際割り込みが多く発生することが大変であるという意味がわかりました。</p>
<p><code>Traffics between Nexus5548 and QFX5100</code> のグラフから <code>Nexus5548 &lt;==&gt; QFX5100</code> 間の通信のロードバランスは非常に美しく4つのインターフェイスに対して等コストバランシングができていることがわかりました。 <code>Nexus5548 ==&gt; QFX5100</code> と <code>Nexus5548 &lt;== QFX5100</code> 両方向で等コストバランシングされていることから両方の機種がよい性能を持っていることがわかりました。</p>
<p>NAVTは <code>10 Gbps * 2</code> のNICを刺したサーバの2台構成で <code>8 Gbps</code> は余裕であることがわかりました。 :clap:</p>
<h2>まとめ</h2>
<p>バックボーン担当は以上の通り様々な技術的挑戦をしながら参加者に快適に問題を解いてもらうことを目標にバックボーンを構築しています。興味を持った方は是非これから続く記事も読んでいただき、わからないところを自分で調べることで知識を深めていただければと思います。</p>
<p>また、機材提供をしていただける皆様！！面白い機材、お待ちしております！！</p>
<p>改めて、参加者・関係者の皆様ありがとうございました。次回も是非参加をよろしくお願いいたします！！</p>
