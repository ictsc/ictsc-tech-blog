---
title: "問題解説: ホビットの国 第二のトラブル"
description: "問題解説: ホビットの国 第二のトラブル"
tags: [ICTSC8,サーバー関連,問題解説]
pubDate: 2017-09-14T13:42:47
slug: "2017/09/14/問題解説: ホビットの国 第二のトラブル"
draft: false
renderer: "html"
sticky: false
---

<h2>問題文</h2>
<p>ホビットカンパニーの社長からの1つ目のトラブルを解決した後、社長が嬉しそうに話かけてきた。</p>
<p>ホビット社長「やっぱり君たちにお願いしてよかったよ」</p>
<p>エイト「褒められてるわよ、やったじゃない！」</p>
<p>すると社長が独り言のように呟いた。</p>
<p>ホビット社長「もしかしたら…君たちならあのトラブルを解決してくれるかもしれないな」</p>
<p>エイト「何かあるんですか？」</p>
<p>ホビット社長「実は我が社でOpenStackを構築したのだが、何故かログインできないのだ。もしよければ解決してくれないか？」</p>
<h2>アクセスできるサーバ</h2>
<ul>
<li>OpenStack All-in-One がセットアップされたサーバ1台のsshのアクセス情報 (sudo権限あり)</li>
</ul>
<h2>達成すべき事項</h2>
<ul>
<li>OpenStack Horizon のダッシュボードを開ける状態にする</li>
</ul>
<h2>問題内容</h2>
<p>ICTSC7 の運営側で実際に起きたトラブルを(厳密ではないですが)再現したものです。今回は<a href="https://blog.icttoracon.net/2017/09/02/ictsc8-committee-trouble/">電源に関するトラブルがありました</a>が、ICTSC7 ではこのようなトラブルがおきており、しかもその際には HotStage 期間に3日を費やすも原因が究明できず、お蔵入りとなったのでありました。</p>
<p>OpenStack Horizon は Python で書かれた WSGIアプリケーションで、OpenStack の各コンポーネントのフロントエンドとしての機能を果たすコンポーネントです。<br />
Horizon の設定ファイルは主に <code>/etc/httpd/conf.d/15-horizon_vhost.conf</code> と <code>/etc/openstack-dashboard/local_settings</code> に記述されていますが、今回は一方のみを変更しています。</p>
<p>この中で、認証サーバである Keystone のエンドポイント等を指定しているのですが、その際に Keystone の API バージョンを誤って指定したことによりトラブルが発生していました。</p>
<p>具体的には、以下の部分を変更して出題しました。</p>
<p><code>/etc/openstack-dashboard/local_settings</code> 200行目付近</p>
<p><code>OPENSTACK_KEYSTONE_URL = "http://10.0.0.20:5000/v2.0"</code></p>
<p>変更後 (問題が起きている状態) は以下です。</p>
<p><code>OPENSTACK_KEYSTONE_URL = "http://10.0.0.20:5000/v3.0"</code></p>
<h2>回答例</h2>
<p>まず、認証情報ですが <code>/root/keystonerc_admin</code> に <code>openstack</code> コマンドを使用する際に使用する認証情報(IDとパスワード等) が記述されています。</p>
<p>問題内容の節にて述べた設定ファイルの変更を元に戻し、た上で、Apache のリスタートを行うことで問題が解決します。<br />
また、Apache をリスタートしてもブラウザからログインができず、エラーもでずにログイン画面からログイン画面にリダイレクトし続ける状態になることがありますが、これはブラウザのセッション(クッキー)を削除することで解決します。<br />
(これについては Keystone 等にも特にエラーログが流れないので、解決に苦労した方もおられるかもしれません。)</p>
<p>想定解は上記の通りでしたが、<code>OPENSTACK_KEYSTONE_URL = "http://10.0.0.20:5000/v3"</code> にすることでも問題が解決するようでした。このあたりは OpenStack のバージョンにも依存してきますね。</p>
<h2>講評</h2>
<p><code>/root/keystonerc_admin</code> を使用しての<code>openstack</code> コマンドを用いた操作は正常に行えることから、 Keystone 側の設定がおかしいわけではないということがある程度予想できます。</p>
<p>その上で、Horizon にのみログインできないという挙動から Horizon の設定における Keystone 関連のエンドポイントのパスやバージョンを確認するというのが運営側の想定解答方針でした。</p>
<p>本問のトラブルは、 OpenStack Ocata では起きないため、意図的に OpenStack Newton を使用して構築された OpenStack 上でのトラブルでした。このバージョンからトラブルに気が付いた方もおられたのでは無いでしょうか。</p>
<p><strong>前回の運営委員が解決できなかったということを踏まえ</strong> 、配点がかなり高い問題でしたが、6チームから解答を受け、4チームが正解されました。</p>
<h2>おわりに</h2>
<p>なかなか OpenStack を手で構築したという方は少ないかもしれませんが、そのような経験があると、全体のコンポーネントの関連性や設定についても理解が深まるため、一度行われてみると良いかもしれません。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
