---
title: "問題解説：Pingは返ってくるのにwebが見れない"
description: "問題解説：Pingは返ってくるのにwebが見れない"
tags: [ICTSC9,ネットワーク関連,問題解説]
pubDate: 2018-04-08T13:55:17
slug: "2018/04/08/問題解説：Pingは返ってくるのにwebが見れない"
draft: false
renderer: "html"
sticky: false
---

<p><img decoding="async" loading="lazy" src="/images/wp/2018/04/NAS-300x76.jpg.webp" alt="" width="600" height="152" class="alignnone size-medium wp-image-1693"></p>
<h1>問題文</h1>
<p>仮想機密伝送路課の検証環境ラボ（以下、ラボという）のWANルータ(Router1)をリプレースすることになった。</p>
<p>リプレースの要件としては基本的にリプレース前のネットワーク機器から設定をコンバートするだけなのだが、<br />
今回新たな要件として本番環境で動いているwebサーバにラボから接続出来るようにしてほしい言われた。</p>
<p>ただ本番環境とラボは同じセグメントを使用しており、そして擬似的にwebサーバをラボにあるように見せる様に複数回NATをして対処してくれと要望があった。<br />
またラボのクライアントからwebに繋げるipアドレスはRouter1のNATで192.168.14.200のアドレスを利用してwebページを見れるようにしてくれとも言われている。</p>
<p>そのためラボにおいてある別のルータ(Router2)から本番環境のWANルータ(Router3)にプロバイダーサービスのl2vpnを利用してRouter2とRouter3を繋げ、<br />
3段階NATをすることによってwebサーバを見れるようにNATの設定を仮想機密伝送路課の担当者が行った。</p>
<p>しかしNATの設定後、ラボのPCからWebサーバ(192.168.14.200)に対しての通信で以下の現象が発生した。<br />
&#8211; ラボのPCからwebサーバ(192.168.14.200)に向かってpingを打つと返ってくる<br />
&#8211; Webページを見ることが出来ない</p>
<p>担当者「192.168.14.200に対してpingが返ってくるんだからwebページが見れないのはサーバ屋の問題だ！」</p>
<p>諸君にはRouter2と、webサーバに接続してトラブルシュートをし原因を突き止めてwebページが見れるようにして欲しい。<br />
今回動いているwebサーバは公開用のipアドレスとは別にマネージメントのipアドレスがあるのでそこからsshすることができる。</p>
<h2>制約</h2>
<ul>
<li>設定を変更できるのはwebサーバとRouter2(1841)のみである</li>
<li>Router2(1841)のデフォルトルートを変えてはいけない</li>
</ul>
<h2>スタート</h2>
<p>webサーバ(natip 192.168.14.200)に対してpingは通るのにwebページが見れない。</p>
<h2>ゴール</h2>
<p>webサーバ(natip 192.168.14.200)にpingも通り、またapacheのテストページを見ることが出来る。</p>
<h2>情報</h2>
<ul>
<li>webサーバマネージメントssh情報</li>
<li>192.168.14.200はweb公開用なのでicmpとhttpしか許可をしていない</li>
<li>手元のPCは2960-Bの４番ポートに接続してください。dhcpが振ってきます。</li>
<li>Router2のアクセス情報</li>
<li>Router1は <code>ip nat outside source static 192.168.14.70 192.168.14.200</code>の設定が入っている。</li>
<li>Router3は <code>ip nat inside source static 192.168.14.70 192.168.30.130</code>の設定が入っている</li>
<li>インターフェースのinside,outsideは図に書いています。</li>
<li>問題文に <code>プロバイダーサービスのl2vpnを利用して</code> とありますが今回は直接結線をしています。</li>
<li>この問題にvrfは関係ありません</li>
</ul>
<h1>トラブルの概要</h1>
<p>pingが通るのにwebが見れないということは一見サーバ側の問題かなと思うかもしれませんが、その割には手元機材の情報があったり、webサーバは特に問題が無いように見えます。<br />
この問題実はpingを返しているのはWebサーバではなく、NATルータです。</p>
<h1>解説</h1>
<p>この問題ではサーバ側の不備は一切なくRouter2が原因です。<br />
cisco機器で内部と外部を同セグに見せるようなNATをする場合にありがちな設定ミスです。<br />
NATの設定に不備があるため、NATされたアドレスがルーティングテーブルに乗らずRouter2がNATのアドレスを持ってしまいRouter2がpingの応答をしてしまっています。<br />
なのでNATのルーティングを正しく書けば解決します。</p>
<h1>解答例</h1>
<p>Router2</p>
<pre class="brush: plain; title: ; title: ; notranslate" title=""><code>- ip route 192.168.14.130 255.255.255.255 FastEthernet0/1.1647
+ ip nat outside source static 192.168.14.130 192.168.14.70 add-route
+ ip route 192.168.14.130 255.255.255.255 192.168.14.131</code></pre>
<h1>採点基準</h1>
<p>NATに問題があることの指摘、及び設定変更してwebが見れる→満点</p>
<h1>講評</h1>
<p>この問題が解放されたのが遅かった為解答したチームはありませんでした。<br />
pingが届くのにwebが見れないと聞いたらみなさんはとりあえずサーバに問題があるのでは？と考え問題の無いサーバ側を調べていたかと思われます。<br />
複雑にNATを使用した場合（例えば同セグに見せるようなNAT）ping返答しても設定ミスでルータが返してあることがたまにあるのでみなさん気を付けてください。</p>
