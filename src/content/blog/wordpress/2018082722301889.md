---
title: "問題解説: Xen 筆記"
description: "問題解説: Xen 筆記"
tags: [ICTSC2018,サーバー関連,問題解説]
pubDate: 2018-08-27T22:30:58
slug: "2018/08/27/問題解説: Xen 筆記"
draft: false
renderer: "html"
sticky: false
---

<h1>1問目</h1>
<h2>問題文</h2>
<p>LinuxカーネルでXenが動作するアーキテクチャとして最も近いものを答えてください。</p>
<ul>
<li>KVM</li>
<li>Docker</li>
<li>VirtualBox</li>
<li>Hyper-V</li>
</ul>
<h2>解説</h2>
<ul>
<li>KVM
<ul>
<li>ネイティブ型ハイパーバイザ</li>
<li>モノリシックカーネルアーキテクチャ</li>
</ul>
</li>
<li>Docker
<ul>
<li>アプリケーションコンテナ</li>
</ul>
</li>
<li>VirtualBox
<ul>
<li>ホスト型ハイパーバイザ</li>
</ul>
</li>
<li>Hyper-V
<ul>
<li>ネイティブ型ハイパーバイザ</li>
<li>マイクロカーネルアーキテクチャ</li>
</ul>
</li>
<li>OpenVZ
<ul>
<li>OSコンテナ</li>
</ul>
</li>
</ul>
<p>Docker, OpenVZと言ったソフトはコンテナ仮想化であり、カーネルを全ての仮想マシンで共有してユーザ空間を隔離する技術です。</p>
<p>VirtualBoxはQemuと同じように、OSの上でソフトウェアを起動し、OSの機能を利用して仮想化を行う技術です。</p>
<p>KVM・Xen・Hyper-Vと言ったソフトは、仮想化とその管理の機能を含めたOS制御全ての機能をカーネルに含めたアーキテクチャです。</p>
<p>このうち、KVMでは管理カーネル上でその他のプログラムが動作しますが、<br />
Xenではdom0と呼ばれる管理用の仮想マシンが作成され、その上でカーネルに対して仮想化サーバーの起動などを命令します。<br />
Hyper-VはXenと同様に、管理を行うための仮想マシンが作成され、その上で管理用のプログラムやGUIが動作しています。</p>
<p>Xenでは、管理用の仮想マシンをDomain-0(dom0)、その他の仮想マシンをDomain-U(domU)と呼び、<br />
Hyper-Vではそれぞれ親パーティション (Root Partition, Parent Partition)、子パーティション (Child Partition)と呼びます。</p>
<h2>講評</h2>
<p>調べればわかる問題ということもあり、問題の正答率は高かったです。<br />
誤答を見ると、同じLinux OS上で動作するということからか「KVM」を選択するチームも見られました。<br />
仮想化を扱う際にはその仮想化の動作原理を知るとトラブルシューティングの際に便利なことがあります。</p>
<h1>2問目</h1>
<h2>問題文</h2>
<p>Xenのトラブルシューティングを行う際に見るべきファイル・実行するべきコマンドを箇条書きで答えよ。<br />
なおこの問題はファイル・コマンドの出力結果から見ることの出来る情報の種類や重要度により点数が増減する。</p>
<h2>解説</h2>
<p>Xenでは、ログファイルを <code>/var/log/xen</code> に保存しています。<br />
また、Xenの管理を行うプログラムに <code>xm</code> (以前のバージョンは <code>xl</code> )があります。<br />
Xenのシステムのトラブルシューティングはこれらのファイル・コマンドで充分に行えます。<br />
またその他にも <code>/var/lib/xen/</code>, <code>/var/xen/dump/</code> に内部で生成されるダンプやデータベースが、<br />
<code>/etc/xen</code>に設定ファイルが、<br />
<code>/proc/xen</code>でXenのカーネル情報が取得できます。</p>
<p>参考: <a href="https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/5/html/virtualization/chap-virtualization-troubleshooting_the_xen_para_virtualized_drivers">第32章 Xen para-virtualized ドライバーのトラブルシューティング &#8211; Red Hat Customer Portal</a></p>
<p>その他、この問題では言及していないものとして、現在稼働中の物を確認するためのコマンドとしての<code>xentop</code>や<br />
libvirtを使用している場合はそれに関連するディレクトリ、<br />
ネットワークに関連するトラブルとしては ネットワークのパケットキャプチャなど、仮想マシンのトラブルシューティングでは見るべき部分が多数あります。</p>
<p>今回の問題はXen本体のトラブルを解決するために必要なファイル・コマンド群双方に言及している場合に最高点数を付与しています。<br />
ファイルのみ・コマンドのみの場合は取得できる情報から30％〜70％で付与しています。<br />
その他のトラブルについて解決するためのコマンド類を記述しているチームには、問題の最高点を上限として加点をしています。</p>
<h2>講評</h2>
<p>問題文と自由記述の欄から、回答に苦労したチームが多かったのではと思います。<br />
問題文に「見るべきファイル・実行するべきコマンド」と明記しており、ファイルとコマンド双方を回答してくれることを想定していたのですが、コマンドのみ・ログファイルのディレクトリのみの回答も複数ありました。<br />
中には20以上のファイル・コマンドを回答として提出したチームもありました。<br />
情報の中からトラブルの原因を見つけ出し解決に漕ぎ着ける為に、トラブルごとに見るべき項目は異なります。<br />
その際に「どの情報が必要か」を考え、その時々で適切なコマンドの実行・ファイルの閲覧を行うことが大切です。<br />
この時に「どのコマンドで何が取得できる」という事を知っておく事はプラスになります。</p>
<h1>3問目</h1>
<h2>問題文</h2>
<p>Xenの仮想化方式にPVとHVMがありますが、それぞれの違いについて説明してください。</p>
<h2>解説</h2>
<p>まずPVですが、これはCPUの機能である仮想化支援がなくてもVMを動作させることができる方式です。ただし、VMを動作させるにはPVに対応するドライバが必要なので、そのドライバを別途インストールする必要があります。また、Xenに対応したゲストOSを用いることで、ハードウェアを触らずに高速動作しますが、メモリマッピングといった直接ハードウェアを触る部分で遅延が発生する欠点があります。<br />
HVMはPVと違い、使用するCPUに仮想化支援の機能が必要です(intelならVT-x, AMDならAMD-V)。HVMはqemuを使用してBIOSや様々なコントローラをエミュレートするため、PVのように専用ドライバをインストールする必要がありません。仮想化支援の機能を使うのでハードウェアを触る処理が高速に行える特徴を持ちます。</p>
<h2>講評</h2>
<p>XenはAmazonが運営しているAWSに採用されています。そのためか、解答にAWS特有の名称などを用いて説明しているチームが複数ありました。<br />
全体的に見てしっかりと説明しているチームが多かったなと思います。</p>
<h1>4問目</h1>
<h2>問題文</h2>
<p>PVとHVMを組み合わせたPVHがりますが、この仮想化方式についてPVとHVMを使って説明してください。</p>
<h2>解説</h2>
<p>3問目の解説にもある通り、PVはXenに対応したゲストOSを用いることで、ハードウェアを触らずに高速動作しますが、メモリマッピングといった直接ハードウェアを触る部分で遅延が発生します。PVの欠点であるハードウェアを触る処理を、HVMで使われている仮想化支援の機能を使って高速にできるのがPVHとなります。</p>
<h2>講評</h2>
<p>3問目より4問目の方が回答率が高かったです。</p>
