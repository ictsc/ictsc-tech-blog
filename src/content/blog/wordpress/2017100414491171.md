---
title: "問題解説: 始まりの国 第二のトラブル"
description: "問題解説: 始まりの国 第二のトラブル"
tags: [ICTSC8,問題解説]
pubDate: 2017-10-04T14:49:26
slug: "2017/10/04/問題解説: 始まりの国 第二のトラブル"
draft: false
renderer: "html"
sticky: false
---

<p>こんにちは！始まりの国 第二のトラブルの問題解説をします。</p>
<p>この問題はLinuxの機能であるiproute2を使うことでLinuxでもポリシールーティングのような機能を使うことができ、それが原因でGoogle public DNSに接続できないという問題でした。ウォーミングアップ問題の割に解答率が低くなってしまい、知らなきゃ解きにくい問題だったので少し申し訳ないことになってしまったと反省しています。</p>
<h2>問題文</h2>
<p>問題文は以下の通りです。</p>
<blockquote><p>
  エイトが一行を案内していると、ギルドでの活躍が伝わったのか、エルフのお姉さんが話しかけてきた。</p>
<p>  エルフ「サーバに呪文を書き込んだんだけど、DNSの魔法が動いてないっぽいのよ。ドワーフのおっさんから話は聞いたけど、君たちバリバリできるんだって？　いい感じにしてくれない？」</p>
<p>  エイト「ちょっとあんたたち呼ばれているわよ。……『呪文』が何かわからないって？　呪文は……そうねたしか設定ファイルとかコンフィグって意味だったと思うわ。はやく解決してきなさい」
</p></blockquote>
<p>また、補足事項として以下のような情報を与えました。</p>
<blockquote><p>
  Google public DNSの8.8.8.8もしくは8.8.4.4で名前解決をできるようにしてください。
</p></blockquote>
<h2>問題の再現</h2>
<p>以下の内容を <code>/etc/networking/if-up.d/static-route</code> に記載して再起動を行うことで、 <code>8.8.0.0/16</code> に接続できなくなります。</p>
<pre class="brush: plain; title: ; title: ; notranslate" title=""><code>ip rule add table 100 prio 200
ip route add 8.8.0.0/16 via 127.0.0.1 table 100</code></pre>
<p>設定された内容は以下のコマンドで確認することができます。実際に試してみるとよいかもしれません。</p>
<pre class="brush: plain; title: ; title: ; notranslate" title=""><code># ip rule show
# ip route show table 100</code></pre>
<p>何故このようなトラブルが起きるかというと、Linuxのデフォルトのルーティングテーブルは <code>ip rule show</code> では優先度のpriorityが低く設定されています。それよりも高い優先度でヌルルーティングされてしまったため、パケットが送られないように見えているというわけです。また、 <code>ip rule</code> はあまり見るものではないので気づきにくかったかと思います。</p>
<h2>採点基準</h2>
<p>この問題の採点基準は以下の3点になっています。</p>
<ul>
<li>ルーティングされていないことに気づく</li>
<li>修正しつながることを確認する</li>
<li><code>ip rule</code> が原因であることに気づく</li>
</ul>
<p>また、どんな形でもGoogle public DNSにつながり名前解決できていることを確認できれば次に進むことができるようになっていました。</p>
<h2>解答例</h2>
<ul>
<li><code>ping</code> や <code>traceroute</code> を使い、DNSが引けない原因がL3疎通性にあることを確認する
<ul>
<li>その際、宛先が <code>8.8.8.8</code> のパケットに対して一切外のデバイスから返答がないことからヌルルーティングなどをされていると検討を付ける</li>
</ul>
</li>
<li><code>ip route</code> などの現在のルーティング情報や <code>/etc/networking/</code> 配下などネットワーク系の設定をするファイルを探し原因を特定する</li>
<li><code>/etc/networking/if-up.d/static-route</code>をバックアップを取ったうえで削除し、 <code>ip rule del table 100</code> とすることでGoogle public DNSにつながることを確認する</li>
</ul>
<p>以上の点を作業経過とともに報告書形式で提出してもらえれば満点を与えました。</p>
<h2>講評</h2>
<p>冒頭でも書きましたが、iproute2を一切触ったことのない人にとっては非常に解きにくい良くない問題だったかなと反省しています。</p>
<p>ただし、原因について言及せずに <code>/etc/networking/if-up.d/static-route</code> を削除して再起動したら治りました、という回答が多く見られました。その際には</p>
<blockquote><p>
  <code>ip rule</code> が原因であることに気づく
</p></blockquote>
<p>という採点基準をもとに減点をしています。大抵の場合はトラブルをどんな形でさえ解決すれば次の問題に進むことができます。しかし、次回以降参加する際にはとりあえず治ったからOKではなくトラブルの原因について言及すると満点を得ることができ、上位を狙うことができるかと思いますので参考にしていただきたいと思います。</p>
