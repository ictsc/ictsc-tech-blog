---
title: "問題解説: サーバーが再起動する！"
description: "問題解説: サーバーが再起動する！"
tags: [ICTSC5,サーバー関連,問題解説]
pubDate: 2016-03-31T13:06:28
slug: "2016/03/31/問題解説: サーバーが再起動する！"
draft: false
renderer: "html"
sticky: false
---

<p>みなさんこんにちは． 2日目午前の問題 (サーバーが再起動する！) を作成した市川です．</p>
<h1>本問題の背景 (CVE-2015-5600の概要)</h1>
<p>OpenSSHでは，LinuxのPAMモジュールを利用することで認証プロセスをアプリケーションから分離して行うことができます．パスワードを用いた認証には大きく分けて2種類の方法があり，</p>
<ul>
<li><span style="line-height: 1.5"> PasswordAuthentication</span></li>
<li><span style="line-height: 1.5"> ChallengeResponseAuthentication</span></li>
</ul>
<p><span style="line-height: 1.5">です．</span></p>
<p>いずれの方法もLinuxに登録されているユーザーの認証情報を用いてログインを行いますが，PasswordAuthenticationが平文でパスワードの照合を行うのに対し，ChallengeResponseAuthenticationはチャンレンジレスポンス認証を用いるため平文パスワードがネットワークを流れることはありません．(もちろんSSLで暗号化されているため平文ではないが，復号するとパスワードがそのまま見える，という意味です．)<br />
以上の理由からChallengeResponseAuthenticationが用いられることはそれほど珍しくなく，また鍵の設置を必要としないため緊急時のログイン手段としてはよく用いられます．</p>
<p>さて，ChallnegeResponseAuthenticationを行うデバイスには<code>bsdauth</code>, <code>pam</code>, <code>skey</code>があり，これらを指定することで認証デバイスを順に試すことができます．今回用いた脆弱性CVE-2015-5600は，このデバイスにpamをカンマ区切りで大量に指定することで，パスワード認証の本来の上限回数を超えて試行出来てしまう，というものです．</p>
<h1>問題文</h1>
<p>最近サーバー(10.X.10.2)が頻繁に再起動して困っている．<br />
原因調査と問題解決をお願いしたい．<br />
また，報告する際には</p>
<ul>
<li>何が原因だったのか</li>
<li>それに対しどのような対処を行ったか</li>
</ul>
<p>を明記していただきたい．<br />
また，サーバーに何らかの脆弱性が存在する場合は必ずその箇所を修正すること．</p>
<h1>解説</h1>
<p>問題が公開されてからしばらくすると，CVE-2015-5600を悪用したブルートフォース攻撃が開始されます．攻撃対象のユーザー<code>ubuntu</code>のパスワードは<code>12345</code>に設定されており，10000から順にインクリメントしながら攻撃を行います．ログインに成功したらすぐに<code>sudo reboot</code>を行い，作業妨害を行うことを繰り返します．<br />
なお，Linuxの標準の設定ではPAMモジュールにfaildelay (ログインが失敗した際，強制的に待ち時間を入れるモジュール)が設定されており，これでは競技時間内にブルートフォース攻撃を複数回仕掛けることは困難でした．そのため<code>/etc/pam.d/</code>以下のfaildelayに関する設定を全て解除，無効化し，1秒間に最大で約10回のパスワード入力が試行できるよう細工を施しました．</p>
<p>この問題を解決するためには，</p>
<ul>
<li><code>ChallengeResponseAuthentication</code>を無効にする</li>
<li>公開鍵認証方式に変える</li>
<li><code>/etc/pam.d</code>の不適切な設定を修正する</li>
</ul>
<p>などの対策を講じることで解決できます．(以上3点が揃った解答に対しては満点を与える予定でした．)</p>
<h1>講評</h1>
<p>ほとんどのチームが</p>
<ul>
<li>特定の端末 (攻撃サーバー)からのアクセスを制限</li>
<li><code>ubuntu</code>ユーザーの設定を変える (パスワード変更，sudo権限剥奪，ユーザー削除)</li>
</ul>
<p>など，根本的な解決に至っていない解答をしていました．そのため問題文に<br />
<strong>また，サーバーに何らかの脆弱性が存在する場合は必ずその箇所を修正すること．</strong><br />
の部分を強調して再度周知したものの，完全な正解に至る解答は見られませんでした．<br />
麻生情報ビジネス専門学校チームが唯一CVE-2015-5600に言及しており，高い得点を与えましたが，PAMの設定不備を指摘したチームは1つもありませんでした．</p>
