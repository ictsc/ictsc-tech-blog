---
title: "問題解説：ぼよよんのみ"
description: "問題解説：ぼよよんのみ"
tags: [ICTSC9,サーバー関連,問題解説]
pubDate: 2018-03-26T21:49:43
slug: "2018/03/26/問題解説：ぼよよんのみ"
draft: false
renderer: "html"
sticky: false
---

<h1>問題文</h1>
<p>近年のゲーム市場拡大に感化され我が社でも仮想遊戯開発部が新設された。<br />
新サービスに向けてオンラインゲームを試作し、制作環境での複数人対戦は仕様書通りの動作が確認されている。<br />
しかし、ステージング環境ではなんらかの設定ミスにより動作に支障が生じた。<br />
原因を調べ、仕様書通りに動作するようにしてほしい。<br />
また、ゲームの仕様に脆弱性があれば合わせて報告してほしい。</p>
<h2>制約</h2>
<p>ゲーム自体のソースコードの改変は禁止。</p>
<h2>スタート</h2>
<p>ゲーム開始後、ユーザ登録を行ってもmainシーンに遷移しない。</p>
<h2>ゴール</h2>
<p>仕様通りにゲームがプレイできる。<br />
local portが枯渇する仕様やパフォーマンスを指摘できている。<br />
スコアを無限に増やせる脆弱性等を指摘できている。</p>
<h1>解説</h1>
<p>この問題は、取引先から仕様書を渡され、仕様通りにオンラインゲームを動作させるというものでした。</p>
<h2>トラブルの内容</h2>
<p>Webサーバ上では、以下のような現象が発生していました。<br />
&#8211; ゲームがスタートしない<br />
&#8211; 攻撃ができない・アイテムが取れない<br />
&#8211; ランキングが反映されない</p>
<p>これらは、以下に挙げるトラブルが原因でした。</p>
<h3>1. Redisの使用できるメモリが足りない</h3>
<p>参加者の情報は、Redisサーバで管理されていましたが、設定ミスでmaxmemoryを1にしてしまっていました。<br />
そのため、<code>/etc/redis/redis.conf</code>内のmaxmemoryを1gなどに変更する必要がありました。</p>
<h3>2. ufwの開放しているポートが間違っている</h3>
<p>ufwをセキュリティを考慮して有効にしていましたが、ゲームで使うポートを開けていないトラブルがありました。<br />
そのため、正しく使うポートのみを解放する必要がありました。</p>
<h3>3. 使えるローカルポートの数が制限されている</h3>
<p>通常、ネットワーク通信をする側はローカルポートを消費します。使えるローカルポートの範囲はカーネルパラメータで設定することができます。このゲームは、redisにたくさんコネクションを貼るため、sysctlでパラメータをいじったのですが、ip&#95;local&#95;port_rangeの値を間違えて設定していたため、疎通が取れなくなっていました。<br />
そのため、ポートの範囲を広げる必要がありました。</p>
<h2>その他</h2>
<p>このゲームはできるだけ短い間隔でudpによる通信を行い、その度に新しいコネクションをredisにはる仕様になっていました。<br />
このため、パフォーマンスがどうしても制限されてしまいます。</p>
<p>また、ユーザIDは他のプレイヤーに通知されない仕組みになっていましたが、自分のIDはわかるため高さを偽装しスコアを伸ばす、または任意の座標に攻撃を行うことができる仕様的な脆弱性がありました。</p>
<p>そのため、この２点について言及されていた場合は加点の対象としました。</p>
